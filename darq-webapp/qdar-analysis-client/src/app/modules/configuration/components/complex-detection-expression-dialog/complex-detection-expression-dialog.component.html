<div style="width: 100%; height: 100%; display: grid; grid-template-columns: minmax(10px, min-content) 1fr; border: 1px solid rgb(189, 189, 189);">
  <div style="height: 100%; background-color: white; display: grid; grid-template-rows: 40px 50px 1fr; overflow: hidden; border-right: 1px solid rgb(189, 189, 189);">
    <div style="padding: 5px; display: flex; justify-content: center; align-items: center; font-weight: bold; background-color: #f6f6f6;">
      Detections
    </div>
    <div style="padding: 5px; display: flex; justify-content: center; align-items: center; background-color: #f6f6f6; border-bottom: 1px solid rgb(189, 189, 189);">
      <div class="input-group" style="min-width: 400px;">
        <div class="input-group-prepend">
          <span class="input-group-text"><i class="fa fa-search"></i></span>
        </div>
        <input type="text" class="form-control" placeholder="Search" aria-label="Search" (input)="filterChange($event.target.value)">
      </div>
    </div>
    <ul class="list-group" style="height: 100%; overflow: scroll;">
      <li *ngFor="let item of filteredDetections$ | async" style="cursor: pointer; border-bottom: 1px solid rgb(239, 239, 239);" pDraggable="expression" (onDragStart)="dragDetectionStart(item)" (onDragEnd)="dragEnd()">
        {{item.id}} - {{item.description}}
      </li>
    </ul>
  </div>
  <div style="height: 100%; background-color: rgb(249 249 249); display: grid; grid-template-rows: max-content 1fr max-content; overflow: hidden;">
    <div style="display: flex;">
      <div style="padding: 10px; display: flex; align-items: center; justify-content: center; background-color: #f6f6f6; border-bottom: 1px solid rgb(189, 189, 189); border-right: 1px solid rgb(189, 189, 189); font-weight: bold;">
        Operators
      </div>
      <div style="display: flex; border-bottom: 1px solid rgb(189, 189, 189); background-color: white;">
        <div *ngFor="let item of operators" pDraggable="expression" (onDragStart)="dragOperatorStart(item)" (onDragEnd)="dragEnd()" style="display: flex; align-items: center; justify-content: center; cursor: pointer; padding-right: 15px; padding-left: 15px; padding-top: 10px; padding-bottom: 10px; border-right: 1px solid rgb(189, 189, 189);">
          {{item}}
        </div>
      </div>
      <div style="padding: 10px; background-color: #f6f6f6; border-bottom: 1px solid rgb(189, 189, 189); width: 100%; display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; gap: 5px;">
          <input type="checkbox" [(ngModel)]="showDescriptionTree"> Show Detections Description
        </div>
        <div style="display: flex; align-items: center; justify-content: flex-end; gap: 5px;">
          <button class="btn btn-sm btn-danger" (click)="cancel()">
            <i class="fa fa-trash"></i>
            Cancel
          </button>
          <button class="btn btn-sm btn-success" [disabled]="hasPlaceholder" (click)="close()">
            <i class="fa fa-save"></i>
            Save
          </button>
        </div>
      </div>
    </div>
    <div style="padding: 10px; overflow: scroll;">
      <div style="color: rgb(163, 163, 163);">
        <span><i class="fa fa-info-circle"></i> Drag and Drop Detections & Operators</span>
      </div>
      <p-organizationChart [value]="tree">
        <ng-template let-node pTemplate="default">
          <div *ngIf="node.data.placeholder" style="padding: 10px; background-color: #d7f5ff; border: 2px dashed blue; font-weight: bold; text-wrap: nowrap;" pDroppable="expression" (onDrop)="drop(node)">
            DROP HERE
            <button *ngIf="node.parent && node.parent.children.indexOf(node) > 1" class="btn btn-sm btn-danger" style="border-radius: 0; padding: .01rem .3rem; margin-left: 5px;" (click)="remove(node)">
              <i class="fa fa-trash"></i>
            </button>
          </div>
          <div *ngIf="!node.data.placeholder && node.data.type !== 'DETECTION'" style="background-color: blue; border: 2px solid black; font-weight: bold; display: flex; align-items: center; justify-content: center;">
            <div style="padding: 10px; color: white;  height: 100%;">
              {{ node.label }} {{node.data.position}}
            </div>
            <div style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: space-between; background-color: white;">
              <button class="btn btn-sm btn-danger" style="border-radius: 0; padding: .01rem .3rem;" (click)="clear(node)">
                <i class="fa fa-trash"></i>
              </button>
              <button class="btn btn-sm btn-success" style="border-radius: 0; padding: .01rem .3rem;" *ngIf="node.data.multiple" (click)="add(node)">
                <i class="fa fa-plus"></i>
              </button>
            </div>

          </div>
          <div *ngIf="!node.data.placeholder && node.data.type === 'DETECTION'" style="background-color: purple; color: white; border: 2px solid black; font-weight: bold; display: flex; align-items: center; justify-content: center;">
            <div style="padding: 10px; color: white;  height: 100%;">
              {{ node.label }} {{node.data.position}}
            </div>
            <div style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: space-between; background-color: white;">
              <button class="btn btn-sm btn-danger" style="border-radius: 0; padding: .01rem .3rem;" (click)="clear(node)">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>
          <div *ngIf="node.data.type === 'DETECTION' && node.data.detection" style="padding: 5px; background-color: white; color: black; border: 2px solid black; font-weight: bold;">
            {{ node.data.detection.id }} {{ showDescriptionTree ? " - " + node.data.detection.description : ""}}
          </div>
        </ng-template>
      </p-organizationChart>
    </div>
    <div style="padding: 1em; background-color: rgb(246, 246, 246); border-top: 1px solid rgb(201, 201, 201);">
      <div style="color: gray;">
        <input type="checkbox" name="showDesc" [(ngModel)]="showDescriptionString" (ngModelChange)="updateString()"> Show Detections Description
      </div>
      {{ expressionString }}
    </div>
  </div>
</div>
